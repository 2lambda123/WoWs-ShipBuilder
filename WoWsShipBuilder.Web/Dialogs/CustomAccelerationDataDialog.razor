@using WoWsShipBuilder.Core.Data
@using WoWsShipBuilder.DataStructures
@inject ILocalizer Localizer

<MudDialog>
    <TitleContent>
        <MudItem Class="d-flex align-center">
            <MudIcon Icon="@Icons.Material.Filled.HelpOutline" Color="Color.Info" Size="Size.Large"/>
            <MudText Typo="Typo.h6" Class="mx-auto">
                @Localizer.GetAppLocalization(nameof(Translation.AccelerationChart_CustomDataTitle)).Localization
            </MudText>
        </MudItem>
    </TitleContent>
    <DialogContent>
        <MudStack>
            <MudText>You can set custom values to be plotted in the chart. A name is required. <strong>ADVANCED USERS ONLY.</strong></MudText>
            <MudGrid>
                <MudItem xs="12">
                    <MudTextField @bind-Value="@name" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_Name)).Localization" Variant="Variant.Outlined"/>
                </MudItem>
                <MudItem xs="6">
                   <MudSelect T="ShipClass" Variant="Variant.Outlined" @bind-Value="@selectedClass" Label="Ship Class" AnchorOrigin="Origin.BottomCenter">
                       @foreach (ShipClass item in classList)
                       {
                           <MudSelectItem Value="@item">
                               <MudText Color="Color.Secondary">@Localizer.GetAppLocalization(item.ToString()).Localization</MudText>
                           </MudSelectItem>
                       }
                   </MudSelect>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@maxSpeed" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_MaxSpeed)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@enginePower" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_EnginePower)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@tonnage" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_Tonnage)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@forwardEngineUpTime" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_ForwardEngineUpTime)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@backwardEngineUpTime" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_BackwardEngineUpTime)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@forwardEngineForsag" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_ForwardEngineForsag)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@backwardEngineForsag" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_BackwardEngineForsag)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@forwardEngineForsagMaxSpeed" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_ForwardEngineForsagMaxSpeed)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="@backwardEngineForsagMaxSpeed" Label="@Localizer.GetAppLocalization(nameof(Translation.ShipStats_BackwardEngineForsagMaxSpeed)).Localization" Variant="Variant.Outlined" InputType="InputType.Number"/>
                </MudItem>
            </MudGrid>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Variant="Variant.Filled" Color="Color.Primary">
            @Localizer.GetAppLocalization(nameof(Translation.Cancel)).Localization
        </MudButton>
        <MudButton Disabled="@string.IsNullOrWhiteSpace(name)" OnClick="ReturnShipBuildContainer" Variant="Variant.Filled" Color="Color.Primary">
            @Localizer.GetAppLocalization(nameof(Translation.Ok)).Localization
        </MudButton>
    </DialogActions>
</MudDialog>

@code
{
    [CascadingParameter]
    MudDialogInstance MudDialog { get; set; } = new();
    
    private readonly List<ShipClass> classList = Enum.GetValues<ShipClass>().Except(new List<ShipClass> { ShipClass.Auxiliary }).ToList();

    private string name = string.Empty;
    
    private decimal maxSpeed;

    private int enginePower;

    private int tonnage;

    private decimal forwardEngineUpTime;
    
    private decimal backwardEngineUpTime;
        
    private decimal forwardEngineForsag;
        
    private decimal backwardEngineForsag;
        
    private decimal forwardEngineForsagMaxSpeed;
        
    private decimal backwardEngineForsagMaxSpeed;

    private ShipClass selectedClass;
        
    private void Cancel()
    {
        MudDialog.Cancel();
    }
    
    private void ReturnShipBuildContainer()
    {
        Ship ship = new Ship();
        ship.ShipClass = selectedClass;
        ship.Name = "customShip";
        ship.Index = name;
        ship.ShipNation = Nation.Common;
        ship.Tier = 10;
        
        Hull hull = new Hull();
        hull.MaxSpeed = maxSpeed;
        hull.EnginePower = enginePower;
        hull.Tonnage = tonnage;
        hull.AntiAir = new();
        ship.Hulls = new() {{"Custom hull", hull}};

        Engine engine = new Engine();
        engine.ForwardEngineUpTime = forwardEngineUpTime;
        engine.BackwardEngineUpTime = backwardEngineUpTime;
        engine.ForwardEngineForsag = forwardEngineForsag;
        engine.BackwardEngineForsag = backwardEngineForsag;
        engine.ForwardEngineForsagMaxSpeed = forwardEngineForsagMaxSpeed;
        engine.BackwardEngineForsagMaxSpeed = backwardEngineForsagMaxSpeed;
        ship.Engines = new() {{"Custom engine", engine}};

        UpgradeInfo upgradeInfo = new();
        upgradeInfo.ShipUpgrades = new();

        ShipUpgrade engineUpgrade = new ShipUpgrade();
        engineUpgrade.Name = "Custom engine";
        engineUpgrade.Components = new();
        engineUpgrade.Components.Add(ComponentType.Engine, new[] {"Custom engine"});
        engineUpgrade.UcType = ComponentType.Engine;
        
        ShipUpgrade hullUpgrade = new ShipUpgrade();
        hullUpgrade.Name = "Custom hull";
        hullUpgrade.Components = new();
        hullUpgrade.Components.Add(ComponentType.Hull, new[] {"Custom hull"});
        hullUpgrade.UcType = ComponentType.Hull;

        upgradeInfo.ShipUpgrades.Add(engineUpgrade);
        upgradeInfo.ShipUpgrades.Add(hullUpgrade);

        ship.ShipUpgradeInfo = upgradeInfo;
        ship.ShipConsumable = new();
        
        var container = ShipBuildContainer.CreateNew(ship, null, null);
        MudDialog.Close(DialogResult.Ok(container));
    }

}