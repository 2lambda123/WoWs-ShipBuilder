@page "/"
@using WoWsShipBuilder.Core.DataProvider
@using WoWsShipBuilder.Core.Services
@using System.Collections.ObjectModel
@using System.Collections.Specialized
@inject IAppDataService appDataService
@inject Localizer localizer
@inject NavigationManager navManager

<PageTitle>
    WoWs ShipBuilder
</PageTitle>

<MudContainer Class="mt-3">
    <MudText Align="Align.Center" Typo="Typo.h1" Class="main-title">
        WoWs ShipBuilder
    </MudText>
    <MudText Align="Align.Center" Typo="Typo.h4">
        Welcome to the WoWs ShipBuilder web app.
    </MudText>
    
    <ShipSelector SelectedShips="@selectedShips"/>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@Test">
        Test
    </MudButton>
    <MudText>
        @data
    </MudText>
    <MudButton Disabled="@(selectedShips.Count == 0)" Variant="Variant.Filled" Color="Color.Primary" OnClick="@GoToShipPage">
        Go to ship page
    </MudButton>
    <MudButton Disabled="@(selectedShips.Count == 0)" Variant="Variant.Filled" Color="Color.Primary" OnClick="@GoToPlotPage">
        Make Plot 
    </MudButton>
</MudContainer>

@code
{
    private string data = default!;
    
    private readonly ObservableCollection<string> selectedShips = new();
    
    protected override void OnInitialized()
    {
        base.OnInitialized();
        selectedShips.CollectionChanged += SelectedShipsOnCollectionChanged;
    }

    private void SelectedShipsOnCollectionChanged(object? sender, NotifyCollectionChangedEventArgs e)
    {
        StateHasChanged();
    }

    private void Test()
    {
        data = string.Join("-", selectedShips);
    }
    
    private void GoToShipPage()
    {
        var index = selectedShips.First();
        navManager.NavigateTo("/ship?shipIndex=" + index);
    }
    
    private void GoToPlotPage()
    {
        var indexes = string.Join(",", selectedShips);
        navManager.NavigateTo($"/plots?shipIndexes={indexes}");
    }
    
}
