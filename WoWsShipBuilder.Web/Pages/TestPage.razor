@page "/test"
@using WoWsShipBuilder.Core.Services
@using WoWsShipBuilder.Core.DataProvider
@using WoWsShipBuilder.Core.Localization
@using WoWsShipBuilder.Core.Settings
@using WoWsShipBuilder.Web.Data
@using WoWsShipBuilder.Web.Services
@inject IDataService dataService
@inject IAppDataService appDataService
@inject AppSettingsHelper appSettingsHelper
@inject AppSettings appSettings
@inject ILocalizer Localizer
@inject RefreshNotifierService RefreshNotifierService
@inject TurretAngleVisualizerJsInterop VisualizerInterop

<MudText Typo="Typo.h2">Test Page</MudText>

<MudSelect @bind-Value="selectedCulture" Style="max-width: 500px;">
    @foreach (var culture in AppConstants.SupportedLanguages)
    {
        <MudSelectItem Value="@culture">@culture.CultureInfo.DisplayName</MudSelectItem>
    }
</MudSelect>
<MudButton OnClick="SaveCultureChangeAsync" Disabled="appSettings.SelectedLanguage == selectedCulture">Save culture change</MudButton>
<MudText>@Localizer.GetAppLocalization(nameof(Translation.Battleship))</MudText>
<canvas style="height: 80vh; width: 25vw;position: relative; left: 50%; transform: translateX(-50%);"  id="visualizer"></canvas>
@code {

    private CultureDetails selectedCulture = AppConstants.DefaultCultureDetails;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        selectedCulture = appSettings.SelectedLanguage;
    }

    private async Task SaveCultureChangeAsync()
    {
        appSettings.SelectedLanguage = selectedCulture;
        await appSettingsHelper.SaveSettings(appSettings);
        RefreshNotifierService.NotifyRefreshRequested();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        // if (firstRender)
        // {
            await VisualizerInterop.DrawVisualizerAsync();
        // }
    }

}